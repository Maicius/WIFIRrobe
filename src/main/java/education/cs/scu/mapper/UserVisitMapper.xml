<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="education.cs.scu.mapper.UserVisitMapper">
    <resultMap id="TaskResultMap" type="userVisitBean">
        <result column="shop_id" property="shopId"/>
        <result column="mac" property="mac"/>
        <result column="time" property="time"/>
        <result column="total_flow" property="totalFlow"/>
        <result column="check_in_flow" property="checkInFlow"/>
        <result column="check_in_rate" property="checkInRate"/>
        <result column="shallow_visit_rate" property="shallowVisitRate"/>
        <result column="deep_visit_rate" property="deepVisitRate"/>
    </resultMap>

    <parameterMap id="TaskParameterMap" type="userVisitBean">
        <parameter property="shopId" jdbcType="INTEGER" resultMap="TaskResultMap"/>
        <parameter property="mac" jdbcType="VARCHAR" resultMap="TaskResultMap"/>
        <parameter property="time" jdbcType="VARCHAR" resultMap="TaskResultMap"/>
        <parameter property="totalFlow" jdbcType="INTEGER" resultMap="TaskResultMap"/>
        <parameter property="checkInFlow" jdbcType="INTEGER" resultMap="TaskResultMap"/>
        <parameter property="checkInRate" jdbcType="INTEGER" resultMap="TaskResultMap"/>
        <parameter property="shallowVisitRate" jdbcType="INTEGER" resultMap="TaskResultMap"/>
        <parameter property="deepVisitRate" jdbcType="INTEGER" resultMap="TaskResultMap"/>
    </parameterMap>

    <insert id="addUserVisit" parameterMap="TaskParameterMap">
        INSERT INTO user_visit (
        shop_id,
        mac,
        time,
        total_flow,
        check_in_flow,
        check_in_rate,
        shallow_visit_rate,
        deep_visit_rate
        )
        VALUES (
        #{shopId},
        #{mac},
        #{time},
        #{totalFlow},
        #{checkInFlow},
        #{checkInRate},
        #{shallowVisitRate},
        #{deepVisitRate}
        )
    </insert>

    <select id="queryUserVisit" parameterType="UserFlow" resultMap="TaskResultMap">
        SELECT *
        FROM user_visit a
        WHERE a.time in (
        SELECT max(b.time)
        FROM user_visit b
        )
    </select>

</mapper>